# VRF & PRF

How the SDK uses WebAuthn PRF output and NEAR’s VRF to bind credentials and protect keys.

## PRF (WebAuthn)

- The WebAuthn PRF extension returns per‑relying‑party pseudorandom bytes
- The SDK uses PRF outputs to:
  - Derive deterministic NEAR keypairs (account‑salted)
  - Encrypt private keys at rest in IndexedDB (AEAD)
- PRF material never leaves the wallet origin

## VRF (NEAR)

- A verifiable random function used to prove derivations/challenges
- The SDK provides a VRF worker for challenge generation and a signer worker for transactions
- Both run in WASM workers; private keys stay in worker memory

## Shamir 3‑pass (optional)

- For login UX, the VRF keypair can be wrapped with a random KEK and locked by the server using commutative encryption (Shamir 3‑pass)
- On login, the client adds a temporary lock, server peels its lock, client removes the temp lock, and decrypts with the KEK — the server never learns the VRF key or KEK
- Strict `keyId` mode ensures correct server key selection during rotations

See also:
- [VRF challenges deep dive (SDK docs)](https://github.com/web3-authn/sdk/blob/main/sdk/docs/vrf_challenges.md)
- [Shamir3Pass login flow (SDK docs)](https://github.com/web3-authn/sdk/blob/main/sdk/docs/shamir3pass-login.md)
