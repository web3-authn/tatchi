sequenceDiagram
    participant Client
    participant WebWorker as VRF Web Worker
    participant NEAR as NEAR RPC
    participant Contract as Web3Authn Contract

    Note over Client: Authentication (transaction signing)
    Client->>NEAR: 1. Get latest block (height + hash)
    Note over Client: 2. Construct VRF input with domain separator
    Client->>WebWorker: 3. Send challenge generation request
    WebWorker->>WebWorker: 4. Generate VRF proof + output (no TouchID)
    WebWorker->>Client: 5. VRF challenge + proof
    Note over Client: 6. Use VRF output as WebAuthn challenge
    Note over Client: 7. WebAuthn authentication (TouchID)
    Client->>Contract: 8. verify_authentication(auth, vrf_proof, vrf_input)
    Contract->>Contract: 9. Verify VRF proof ✓
    Contract->>Contract: 10. Extract challenge from VRF output
    Contract->>Contract: 11. Verify VRF pubkey matches stored ✓
    Contract->>Contract: 12. Verify WebAuthn authentication ✓
    Contract->>Client: 13. Authentication complete
