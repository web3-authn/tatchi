sequenceDiagram
    box rgb(243, 244, 246) Iframe Wallet
    participant Wallet as Wallet
    participant Worker as VRF Worker
    end
    participant Relay as Relay Server (Optional)

    Note over Wallet,Worker: Phase 1: Load Encrypted VRF
    Wallet->>Wallet: 1. Retrieve encrypted VRF from IndexedDB

    Note over Wallet,Relay: Phase 2: Shamir 3-Pass Unlock (No TouchID)
    Wallet->>Relay: 2. Request Shamir 3-pass decrypt
    Relay->>Wallet: Server KEK component
    Wallet->>Worker: 3. Decrypt VRF with combined KEK
    Worker->>Worker: 4. VRF keypair loaded into memory
    Worker->>Wallet: 5. VRF session active âœ“
    Note over Wallet: No biometric prompt required

    Note over Wallet,Worker: VRF unlocked - ready to generate WebAuthn challenges
