/* Tokens and defaults for <w3a-drawer> */

w3a-drawer {
  /* Size defaults */
  --w3a-drawer__max-width: 420px;
  --w3a-drawer__sheet-height: 100dvh; /* prefer dynamic viewport */
  --w3a-drawer__open-offset: 0px;     /* mobile chrome compensation */

  /* Colors (inherit from w3a-components by default) */
  --w3a-colors-textPrimary: var(--w3a-grey75);
  --w3a-colors-textSecondary: var(--w3a-grey500);
  --w3a-colors-surface: var(--w3a-slate700);
  --w3a-colors-surface2: var(--w3a-slate750);
  --w3a-colors-surface3: var(--w3a-slate800);
  --w3a-colors-borderPrimary: var(--w3a-grey650);
  --w3a-colors-borderSecondary: var(--w3a-slate650);
  --w3a-colors-colorBackground: var(--w3a-grey800);
}

/* Light theme overrides */
w3a-drawer[theme="light"] {
  --w3a-colors-textPrimary: var(--w3a-grey975);
  --w3a-colors-textSecondary: var(--w3a-grey500);
  --w3a-colors-surface: var(--w3a-slate100);
  --w3a-colors-surface2: var(--w3a-slate150);
  --w3a-colors-surface3: var(--w3a-slate200);
  --w3a-colors-borderPrimary: var(--w3a-slate300);
  --w3a-colors-borderSecondary: var(--w3a-grey300);
  --w3a-colors-colorBackground: var(--w3a-grey50);
}

/* Duplicate token defaults for shadow-adopted usage */
:host {
  --w3a-drawer__max-width: var(--w3a-drawer__max-width, 420px);
  --w3a-drawer__sheet-height: var(--w3a-drawer__sheet-height, 100dvh);
  --w3a-drawer__open-offset: var(--w3a-drawer__open-offset, 0px);
}

/* Structural styles for <w3a-drawer> (used inside ShadowRoot) */
:host { display: contents; }

:host .overlay {
  position: fixed;
  inset: 0;
  /* Keep transparent to avoid initial flash during stylesheet adoption */
  background: transparent;
  z-index: 2147483646;
  opacity: 0; /* No dim overlay */
  pointer-events: none;
  transition: opacity .15s ease;
}

:host([open]) .overlay { /* opacity: 1; */ pointer-events: auto; }

:host .drawer {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  z-index: 2147483647;
  /* Use AccessKeysModal token set; fall back to Lit host vars */
  background: var(--w3a-colors-colorBackground, var(--w3a-color-background, #111));
  color: var(--w3a-colors-textPrimary, var(--w3a-text-primary, #f6f7f8));
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  font-size: 1rem;
  border-radius: 2rem;
  border: none;
  transform: translateY(100%);
  transition: transform 0.15s cubic-bezier(0.32, 0.72, 0, 1);
  will-change: transform;
  box-shadow: 0 0px 8px rgba(0,0,0,0.2);
  padding: 0.5rem;
  /* Constrain width and center horizontally */
  max-width: var(--w3a-drawer__max-width, 420px);
  margin-left: auto;
  margin-right: auto;
  /* Use a tall sheet so we can overpull without clipping */
  height: var(--w3a-drawer__sheet-height, 100vh);
  /* Prefer dynamic viewport height where supported */
  height: var(--w3a-drawer__sheet-height, 100dvh);
  display: grid;
  grid-template-rows: auto 1fr;
}

/* Default to closed (100%) until JS computes the open translate. */
:host([open]) .drawer {
  /* Allow a small upward offset (in px) to compensate for mobile UI chrome */
  transform: translateY(calc(var(--w3a-drawer__open-translate, 100%) - var(--w3a-drawer__open-offset, 0px)));
}

.drawer.dragging, .drawer.vv-sync { transition: none; }
:host .drawer.init { transition: none !important; }
:host([open]) .drawer.dragging { transform: translateY(var(--w3a-drawer__drag-translate, 0px)); }

.handle {
  width: 36px;
  height: 4px;
  border-radius: 2px;
  background: var(--w3a-colors-borderPrimary,rgba(255,255,255,0.25));
  margin: 1rem auto;
  /* Ensure vertical drag gestures on the handle don't trigger page scroll */
  touch-action: none;
}

/* Ensure the body can actually shrink so overflow works inside grid */
.body { overflow: auto; padding: 0; min-height: 0; }
/* Prevent scroll chaining to the page while interacting with the drawer */
.body { overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }

/* Child container to keep content visible above the fold when fully open */
.above-fold {
  position: sticky;
  top: 0;
  background: inherit;
  z-index: 1;
  padding-bottom: max(16px, env(safe-area-inset-bottom));
}

.close-btn {
  position: absolute;
  right: 0.5rem;
  top: 0.5rem;
  width: 40px;
  height: 40px;
  font-size: 24px;
  background: none;
  border: none;
  color: var(--w3a-colors-textMuted, #99a0aa);
  font-size: 28px;
  line-height: 1;
  cursor: pointer;
  border-radius: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all .2s ease;
  z-index: 3;
  /* Ensure taps map to click reliably on mobile */
  touch-action: manipulation;
}

.close-btn:hover {
  color: var(--w3a-colors-textPrimary, #f6f7f8);
  background: var(--w3a-colors-surface, rgba(255,255,255,0.08));
}

.close-btn:active { transform: scale(0.96); }
.close-btn:focus-visible {
  outline: 2px solid var(--w3a-modal__btn__focus-outline-color, var(--w3a-colors-accent, var(--w3a-color-primary, #3b82f6)));
  outline-offset: 3px;
}

.error { color: var(--w3a-colors-error, var(--w3a-red400, #ff7a7a)); font-size: 0.9rem; margin-top: 0.5rem; }
.relative { position: relative; }

/* Light theme adjustments */
:host([theme="light"]) .close-btn { color: var(--w3a-colors-textMuted, #667085); }
:host([theme="light"]) .close-btn:hover {
  color: var(--w3a-colors-textPrimary, #181a1f);
  background: var(--w3a-colors-surface,  rgba(0,0,0,0.06));
}
:host([theme="light"]) .drawer {
  background: var(--w3a-colors-colorBackground, #fff);
  color: var(--w3a-colors-textPrimary, #181a1f);
  border-color: var(--w3a-colors-borderPrimary, rgba(0,0,0,0.08));
}
