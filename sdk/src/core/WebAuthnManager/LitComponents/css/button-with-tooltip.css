/*
   Injected via <link rel="stylesheet"> into the iframe document.
   sets body margins inside the iframe so that the tooltip and button are centered.
   */
body, body.w3a-transparent {
  margin: 0 !important;
  padding: 0 !important;
}

:host {
  display: var(--w3a-embedded__host__display, block);
  font-family: var(--w3a-embedded__host__font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
  background: var(--w3a-embedded__host__background, transparent);
  color: var(--w3a-embedded__host__color, #333);
  line-height: var(--w3a-embedded__host__line-height, 1.6);
  margin: var(--w3a-embedded__host__margin, 0);
  padding: var(--w3a-embedded__host__padding, 0);
  position: var(--w3a-embedded__host__position, relative);
  width: var(--w3a-embedded__host__width, 100%);
  height: var(--w3a-embedded__host__height, 100%);
}

[data-embedded-tx-button-root] {
  position: var(--w3a-embedded__confirm-container__position, relative);
  display: var(--w3a-embedded__confirm-container__display, inline-block);
  z-index: var(--w3a-embedded__confirm-container__z-index, 1001);
  box-sizing: var(--w3a-embedded__confirm-container__box-sizing, border-box);
  overflow: var(--w3a-embedded__confirm-container__overflow, visible);
  pointer-events: var(--w3a-embedded__confirm-container__pointer-events, auto);
  /* Absolute positioning applied via CSS variables for CSP safety */
  position: var(--w3a-embedded__confirm-container__position-absolute, absolute);
  /* Allow fine-grained alignment tweaks via offset variables; default to 0 on both axes. */
  top: calc(var(--w3a-embedded__confirm-container__top, 50%) + var(--w3a-embedded__confirm-container__offset-y, 0px));
  left: calc(var(--w3a-embedded__confirm-container__left, 50%) + var(--w3a-embedded__confirm-container__offset-x, 0px));
  transform: var(--w3a-embedded__confirm-container__transform, translate(-50%, -50%));
}

[data-embedded-btn] {
  /* Transparent interactive shim; visuals are rendered by the host */
  background: transparent !important;
  color: transparent !important;
  border: none !important;
  border-radius: 0;
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  width:  var(--btn-width, 200px);
  height: var(--btn-height, 48px);
  box-sizing: border-box;
  margin: 0;
  outline: none;
  text-decoration: none;
  font-family: inherit;
  opacity: 1;
  will-change: auto;
  animation: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  touch-action: manipulation;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

[data-embedded-btn]:hover { background: transparent !important; color: transparent !important; }

[data-embedded-btn]:active { background: transparent !important; color: transparent !important; }

[data-embedded-btn]:disabled {
  opacity: var(--w3a-embedded__btn-disabled__opacity, 0.6);
  cursor: var(--w3a-embedded__btn-disabled__cursor, not-allowed);
}

[data-loading] { display: none !important; }

[data-loading][data-visible="true"] { display: none !important; }

[data-spinner] {
  width: var(--w3a-embedded__spinner__width, 16px);
  height: var(--w3a-embedded__spinner__height, 16px);
  border: var(--w3a-embedded__spinner__border, 2px solid rgba(255, 255, 255, 0.3));
  border-top: var(--w3a-embedded__spinner__border-top, 2px solid white);
  border-radius: var(--w3a-embedded__spinner__border-radius, 50%);
  animation: var(--w3a-embedded__spinner__animation, spin 1s linear infinite);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Use data attributes instead of classes for guaranteed sync */
[data-tooltip-content] {
  position: var(--w3a-embedded__tooltip-content__position, absolute);
  box-sizing: var(--w3a-embedded__tooltip-content__box-sizing, border-box);
  z-index: var(--w3a-embedded__tooltip-content__z-index, 1000);
  opacity: var(--w3a-embedded__tooltip-content__opacity, 0);
  visibility: var(--w3a-embedded__tooltip-content__visibility, hidden);
  pointer-events: none; /* prevent overlay from stealing hover before interactive */
  /* Ensure the tooltip container itself remains transparent; visuals live inside */
  background: transparent !important;
  background-color: transparent !important;
  height: var(--tooltip-height, auto);
  max-height: var(--tooltip-max-height, none);
  /* Default hidden avoids OS-level scrollbars when content fits. */
  overflow-y: var(--w3a-embedded__tooltip-content__overflow-y, hidden);
  overflow-x: hidden;
  transition: var(--w3a-embedded__tooltip-content__transition, all 0.0s ease);
  /* Allow external control via CSS vars; default to no cap so tooltipPosition.width fully applies */
  min-width: var(--w3a-embedded__tooltip-content__min-width, 0px);
  max-width: var(--w3a-embedded__tooltip-content__max-width, none);
  width: var(--w3a-embedded__tooltip-content__width, var(--tooltip-width, 280px));
  /* Directional padding vars forwarded to tree host */
  --w3a-tree__host__padding-top: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-bottom: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-left: 0px;
  --w3a-tree__host__padding-right: 0px;
}

/* Top positions: aligned with button corners */
[data-tooltip-content][data-position="top-left"] {
  bottom: 100%;
  left: 0; /* Aligns tooltip's left edge with button's left edge */
  margin-bottom: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  /* Add shadow room on the outer side only */
  --w3a-tree__host__padding-right: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-left: 0px;
}

[data-tooltip-content][data-position="top-center"] {
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-left: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-right: var(--tooltip-box-padding, 0px);
}

[data-tooltip-content][data-position="top-right"] {
  bottom: 100%;
  right: 0; /* Aligns tooltip's right edge with button's right edge */
  margin-bottom: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-left: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-right: 0px;
}

/* Side positions */
[data-tooltip-content][data-position="left"] {
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-left: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-right: 0px;
}

[data-tooltip-content][data-position="right"] {
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-left: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-right: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-left: 0px;
}

/* Bottom positions: aligned with button corners */
[data-tooltip-content][data-position="bottom-left"] {
  top: 100%;
  left: 0; /* Aligns tooltip's left edge with button's left edge */
  margin-top: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-right: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-left: 0px;
}

[data-tooltip-content][data-position="bottom-center"] {
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-left: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-right: var(--tooltip-box-padding, 0px);
}

[data-tooltip-content][data-position="bottom-right"] {
  top: 100%;
  right: 0; /* Aligns tooltip's right edge with button's right edge */
  margin-top: calc(var(--tooltip-offset, 4px) - var(--tooltip-box-padding, 0px));
  --w3a-tree__host__padding-left: var(--tooltip-box-padding, 0px);
  --w3a-tree__host__padding-right: 0px;
}

[data-tooltip-content][data-visible="true"] {
  opacity: var(--w3a-embedded__tooltip-content-visible__opacity, 1);
  visibility: var(--w3a-embedded__tooltip-content-visible__visibility, visible);
  pointer-events: auto; /* interactive only when visible */
}

/* When hidden, collapse dimensions so it does not affect geometry */
[data-tooltip-content][data-visible="false"] {
  max-height: 0 !important;
  overflow: hidden !important;
}

[data-tooltip-content][data-hiding="true"] {
  transition-delay: var(--w3a-embedded__tooltip-content-hiding__transition-delay, 150ms);
}

/* Mobile bottom-sheet layout when coarse pointer detected */
[data-tooltip-content][data-mobile-sheet="true"] {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  right: auto;
  top: auto;
  bottom: max(8px, env(safe-area-inset-bottom));
  margin: 0;
  width: min(640px, calc(100vw - 16px));
  max-height: min(70vh, 560px);
  height: auto;
  overflow-y: auto; /* allow scrolling when content exceeds cap */
  -webkit-overflow-scrolling: touch;
  border-radius: 16px;
  box-shadow: none;
  /* Increase tap targets without breaking connector alignment */
  --w3a-tree__label__font-size: 0.9rem;
  --w3a-tree__label__line-height: 1.25;
  --w3a-tree__chevron__width: 14px;
  --w3a-tree__chevron__height: 14px;
  /* Make connectors perfectly flush on mobile */
  --w3a-tree__summary-row__padding: 0px 8px;
  --w3a-tree__row__gap: 0px;
  /* Sub-pixel elbow adjust for iOS Safari rounding */
  --w3a-tree__connector__elbow-top: calc(50% - 0.5px);
  /* Remove top padding inside the tree root on mobile so content hugs the top rounded edge */
  --w3a-tree__tooltip-tree-root__padding: 0px 8px 8px 8px;
  --w3a-tree__file-content__font-size: 0.85rem;
  --w3a-tree__file-content__max-height: 40vh;
}

/* Prefer dynamic viewport units when supported (prevents Safari overflow/bounce) */
@supports (width: 1dvw) {
  [data-tooltip-content][data-mobile-sheet="true"] {
    width: min(640px, calc(100dvw - 16px));
    max-height: min(70dvh, 560px);
  }
}
